<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡ç«¯(pm2)ç›¸å…³æ“ä½œ</title>
    <style>
        code {
            background: rgb(232 234 248);
            border-radius: 3px;
            color: #181515;
            padding: 3px;
        }
    </style>
</head>

<body>


    <h2 id="æœåŠ¡ç«¯pm2ç›¸å…³æ“ä½œ">æœåŠ¡ç«¯(pm2)ç›¸å…³æ“ä½œ</h2>
    <h3 id="ç›¸å…³è·¯å¾„æ ‡å‡†">ç›¸å…³è·¯å¾„æ ‡å‡†</h3>
    <ul>
        <li>pm2 å·¥å…·å­˜æ”¾ä½ç½® <code>~/home/yizhun/.pm2/~</code></li>
        <li>logs å­˜æ”¾åœ°å€
            <ol type="1">
                <li>é»˜è®¤å­˜æ”¾ <code>~/home/yizhun/.pm2/logs/~</code></li>
                <li>æ­¤é¡¹ç›®å­˜æ”¾ <code>~/home/yizhun/yzpacs_db/server-render/logs/~</code></li>
            </ol>
        </li>
    </ul>
    <h3 id="é¡¹ç›®ä»¥åŠ-pm2-ç›¸å…³å‘½ä»¤">é¡¹ç›®ä»¥åŠ pm2 ç›¸å…³å‘½ä»¤</h3>
    <ol type="1">
        <li>
            <p>ç”Ÿæˆé…ç½®<br />
                <code>pm2 init simple</code> æ‰§è¡Œæ­¤å‘½ä»¤å°†ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¦‚: ç›®å‰ä»…åº”ç”¨ä¸‹åˆ—æ¡ä»¶ã€‚å¦‚éœ€æ›´å¤šè¯·å‚è€ƒ<a
                    href="https://pm2.keymetrics.io/docs/usage/application-declaration/">PM2</a>
            </p>
            <div class="sourceCode" id="cb1">
                <pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  <span class="dt">apps</span><span class="op">:</span> [</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;main&quot;</span><span class="op">,</span> <span class="co">// è¿›ç¨‹åç§°</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>      <span class="dt">script</span><span class="op">:</span> <span class="st">&quot;./main.js&quot;</span><span class="op">,</span> <span class="co">// å…¥å£</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>      <span class="dt">out_file</span><span class="op">:</span> <span class="st">&quot;./logs/main-out.log&quot;</span><span class="op">,</span> <span class="co">// æ—¥å¿—é…ç½®æ–‡ä»¶</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>      <span class="dt">pid_file</span><span class="op">:</span> <span class="st">&quot;./logs/main-pid.log&quot;</span><span class="op">,</span> <span class="co">// pidé…ç½®æ–‡ä»¶</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>      <span class="dt">error_file</span><span class="op">:</span> <span class="st">&quot;./logs/main-error.log&quot;</span><span class="op">,</span> <span class="co">// erroré…ç½®æ–‡ä»¶</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>      <span class="dt">min_uptime</span><span class="op">:</span> <span class="st">&quot;60s&quot;</span><span class="op">,</span> <span class="co">// æœ€å°è¿è¡Œæ—¶é—´ï¼Œ 60så†…æ— æ•…åœæ­¢ï¼Œè®¤ä¸ºå¼‚å¸¸é€€å‡ºï¼Œä¼šè§¦å‘ max_restarts è®¾ç½®æ•°é‡</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>      <span class="dt">max_restarts</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span><span class="co">// é»˜è®¤15 é‡å¯æ¬¡æ•°ã€‚</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>      <span class="dt">watch</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// ç›‘æ§ æ–‡ä»¶å˜åŠ¨é»˜è®¤é‡è½½</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>      <span class="dt">cwd</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="co">// é»˜è®¤çš„é¡¹ç›®å¯åŠ¨è·¯å¾„</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    }<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>  ]<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre>
            </div>
        </li>
        <li>
            <p>å¯åŠ¨ &gt;PS:<br />
                deleteä¸stopåŒºåˆ«ï¼šstopå’Œdeleteéƒ½ä¼šåœæ­¢,stopä¸ä¼šå®Œå…¨åˆ é™¤å¯åŠ¨è®°å½•ï¼Œä¸‹æ¬¡ä¼šèµ°ç¼“å­˜ï¼Œdeleteä¼šåˆ é™¤æ­¤è¿›ç¨‹ï¼› å¯é€šè¿‡pm2 show [è¿›ç¨‹åç§°] æ¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚<br />
                restartå’Œreloadï¼š åŒä¸Šã€‚</p>
            <ul>
                <li>
                    <p>pm2 é»˜è®¤æ”¯æŒ<br />
                        â€ƒ <code>pm2 start [æ–‡ä»¶å]</code><br />
                        â€ƒ <code>pm2 start [æ–‡ä»¶å] --name [è¿›ç¨‹åç§°è‡ªå®šä¹‰]</code><br />
                        â€ƒ <code>pm2 start [æ–‡ä»¶å] -i [æ•°å­—]</code> æ ¹æ® CPU æ ¸æ•°å¯åŠ¨è¿›ç¨‹ä¸ªæ•°<br />
                        â€ƒ <code>pm2 start [æ–‡ä»¶å] --watch</code> æ ¹æ®æ–‡ä»¶å˜åŠ¨ è‡ªåŠ¨ reload â€ƒ <code>pm2 updatePM2</code> å‡çº§Pm2<br />
                        â€ƒ <code>pm2 --help</code><br />
                        â€ƒ <code>pm2 delete [all]</code> åˆ é™¤å…¨éƒ¨è¿›ç¨‹<br />
                        â€ƒ <code>pm2 monit</code> ç›‘æ§<br />
                        â€ƒ <code>pm2 stop [all]</code> åœæ­¢<br />
                        â€ƒ <code>pm2 flush</code> æ¸…ç©ºæ—¥å¿— â€ƒ <code>pm2 list</code> æŸ¥çœ‹è¿›ç¨‹ â€ƒ <code>pm2 show [è¿›ç¨‹åå­—]</code>
                        å±•ç¤ºè¿›ç¨‹è¯¦ç»†ä¿¡æ¯.</p>
                </li>
                <li>
                    <p>é¡¹ç›®é…ç½®ï¼ˆè‡ªå®šä¹‰å¯åŠ¨ï¼‰ï¼š<br />
                        â€ƒ <code>pm2 start ecosytem.config.js</code> å¯åŠ¨å…¨éƒ¨çš„é…ç½®é¡¹å†…å®¹<br />
                        â€ƒ <code>pm2 stop ecosytem.config.js</code><br />
                        â€ƒ <code>pm2 restart ecosytem.config.js</code><br />
                        â€ƒ <code>pm2 reload ecosytem.config.js</code><br />
                        â€ƒ <code>pm2 delete ecosytem.config.js</code><br />
                        â€ƒ <code>pm2 start ecosytem.config.js --only main</code> ä»…å¯åŠ¨ä¸€ä¸ª<br />
                        â€ƒ <code>pm2 start ecosytem.config.js --only "main, main2"</code> åŒæ—¶å¯åŠ¨å‡ ä¸ª</p>
                </li>
            </ul>
        </li>
    </ol>
    <h3 id="æ­¤é¡¹ç›®åº”ç”¨">æ­¤é¡¹ç›®åº”ç”¨</h3>
    <ol type="1">
        <li><code>pm2 start ecosystem.config.js --only main</code></li>
        <li><code>pm2 restart ecosystem.config.js --only main</code></li>
        <li><code>pm2 stop ecosystem.config.js --only main</code></li>
        <li><code>pm2 delete ecosystem.config.js --only main</code></li>
    </ol>
    <h3 id="other">Other</h3>
    <ul>
        <li><code>lsof -i:ç«¯å£</code> ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ</li>
        <li><code>ps -ef | grep è¿›ç¨‹åç§°</code> æŸ¥çœ‹ç›¸å…³è¿›ç¨‹çš„ä¿¡æ¯ ğŸŒ°ï¼š<code>ps -ef|grep node</code> æŸ¥çœ‹nodeç›¸å…³è¿›ç¨‹ä¿¡æ¯</li>
        <li><code>kill pid</code> æ€æ­»è¿›ç¨‹</li>
        <li><code>kill 9  pid</code> å½»åº•æ€æ­»è¿›ç¨‹</li>
        <li><code>kill -KILL pid</code> å¼ºåˆ¶æ€æ­»è¿›ç¨‹</li>
        <li><code>kill -9 $(ps -ef | grep hnlinux)</code> è¿‡æ»¤å‡ºhnlinuxç”¨æˆ·è¿›ç¨‹å¹¶æ€æ­»</li>
        <li><code>kill -u hnlinux</code> è¿‡æ»¤å‡ºhnlinuxç”¨æˆ·è¿›ç¨‹å¹¶æ€æ­»</li>
        <li><code>htop</code> æ˜¯Linuxç³»ç»Ÿä¸­çš„ä¸€ä¸ªäº’åŠ¨çš„è¿›ç¨‹æŸ¥çœ‹å™¨ å¦‚æœæ²¡æœ‰å°±ç”¨<code>top</code></li>
        <li><code>top</code> æ€§èƒ½åˆ†æå·¥å…·,èƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µ</li>
        <li><code>as</code> äºŒè¿›åˆ¶å·¥å…·é›†</li>
        <li><code>nvidia-smi</code> æ˜¾ç¤ºGPUå½“å‰çš„çŠ¶æ€</li>
    </ul>
    <h3 id="å…¶ä»–å…¥å£">å…¶ä»–å…¥å£</h3>
    <ul>
        <li><a href="http://10.2.112.138:9292/test">æµ‹è¯•å·¥å…·</a></li>
        <li><a href="http://10.2.112.138:9292/logs">æ—¥å¿—æ–‡ä»¶</a> ï¼ˆå‚æ•°ï¼štypeï¼š error ï½œ pid ï½œ outï¼‰é»˜è®¤out</li>
    </ul>
    <h3 id="å‚è€ƒ">å‚è€ƒ</h3>
    <ul>
        <li><a href="https://pm2.keymetrics.io/docs/usage/application-declaration/">PM2å®˜æ–¹ç®€ä»‹</a><br />
        </li>
        <li><a href="https://wenku.baidu.com/view/842b60cd82c758f5f61fb7360b4c2e3f56272574.html">PM2å¸¸ç”¨å‘½ä»¤</a></li>
        <li><a href="http://www.ha97.com/1029.html">lsof</a></li>
        <li><a href="https://www.cnblogs.com/baichunyu/p/15356162.html">linuxâ€“topå‘½ä»¤</a></li>
        <li><a href="https://blog.csdn.net/K346K346/article/details/89088671">linuxâ€“aså‘½ä»¤</a></li>
        <li><a href="https://www.runoob.com/linux/linux-command-manual.html">linuxæ•™ç¨‹</a></li>
    </ul>

</body>

</html>